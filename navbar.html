<nav class="bg-white shadow-sm sticky top-0 z-10 font-sans">
    <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-2">
            <div class="flex items-center space-x-4">
                <a href="/about" class="text-xs font-semibold text-gray-700 hover:text-blue-600">Yufa Market Tracker</a>
            </div>
            
            {{/* Define variables to check if the current page is active */}}
            {{ $isRankingPage := (or (eq .Data.PageTitle "Characters") (eq .Data.PageTitle "Guilds") (eq .Data.PageTitle "MVP Kills") (eq .Data.PageTitle "WoE Rankings")) }}
            {{ $isStatsPage := (or (eq .Data.PageTitle "Drop Stats") (eq .Data.PageTitle "Player Count")) }}

            <div class="hidden md:flex items-center space-x-1">
                
                {{/* --- MODIFIED: Replaced search icon link with a search form --- */}}
                <form action="/search" method="GET" class="relative" id="nav-search-form">
                    {{/* Prefills search query only if on the global search page */}}
                    <input type="text" name="q" placeholder="{{.Page.T.nav_search_placeholder}}" value="{{if eq .Data.PageTitle "Global Search"}}{{.Data.SearchQuery}}{{end}}" class="block w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 pl-3 pr-8 py-1.5" style="width: 160px;">
                    <button type="submit" class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600" title="{{.Page.T.search}}">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </form>
                
                <a href="/" class="text-sm px-3 py-2 rounded-md {{if eq .Data.PageTitle "Summary"}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">{{.Page.T.nav_summary}}</a>
                <a href="/full-list" class="text-sm px-3 py-2 rounded-md {{if eq .Data.PageTitle "Full List"}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">{{.Page.T.nav_full_list}}</a>
                <a href="/activity" class="text-sm px-3 py-2 rounded-md {{if eq .Data.PageTitle "Activity"}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">{{.Page.T.nav_activity}}</a>
                <a href="/discord" class="text-sm px-3 py-2 rounded-md {{if eq .Data.PageTitle "Discord"}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">{{.Page.T.nav_discord}}</a>
                <a href="/chat" class="text-sm px-3 py-2 rounded-md {{if eq .Data.PageTitle "Chat"}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">{{.Page.T.nav_chat}}</a>
                
                {{/* --- Statistics Dropdown --- */}}
                <div class="relative" id="stats-dropdown-menu">
                    <button id="stats-dropdown-button" class="text-sm px-3 py-2 rounded-md flex items-center {{if $isStatsPage}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">
                        <span>{{.Page.T.nav_statistics}}</span>
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="stats-dropdown-content" class="dropdown-content hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 ring-1 ring-black ring-opacity-5">
                        <a href="/stats/drops" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_drop_stats}}</a>
                        <a href="/players" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_player_count}}</a>
                    </div>
                </div>

                {{/* --- Ranking Dropdown --- */}}
                <div class="relative" id="ranking-dropdown-menu">
                    <button id="ranking-dropdown-button" class="text-sm px-3 py-2 rounded-md flex items-center {{if $isRankingPage}}font-semibold text-blue-600 bg-blue-50{{else}}text-gray-600 hover:bg-gray-100{{end}}">
                        <span>{{.Page.T.nav_rankings}}</span>
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="ranking-dropdown-content" class="dropdown-content hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 ring-1 ring-black ring-opacity-5">
                        <a href="/characters" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_characters}}</a>
                        <a href="/guilds" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_guilds}}</a>
                        <a href="/mvp-kills" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_mvp_kills}}</a>
                        <a href="/woe" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{.Page.T.nav_woe_rankings}}</a>
                    </div>
                </div>

                {{/* --- Language Dropdown --- */}}
                <div class="relative" id="lang-dropdown-menu">
                    <button id="lang-dropdown-button" class="text-lg p-2 rounded-md flex items-center text-gray-600 hover:bg-gray-100">
                        <span>
                            {{if eq .Page.Lang "pt"}}
                                ðŸ‡§ðŸ‡·
                            {{else}}
                                ðŸ‡ºðŸ‡¸
                            {{end}}
                        </span>
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div id="lang-dropdown-content" class="dropdown-content hidden absolute right-0 mt-2 w-36 bg-white rounded-md shadow-lg py-1 z-20 ring-1 ring-black ring-opacity-5">
                        <a href="/set-lang?lang=en&redirect={{.Page.RequestURL}}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <span>ðŸ‡ºðŸ‡¸</span>
                            <span>English</span>
                        </a>
                        <a href="/set-lang?lang=pt&redirect={{.Page.RequestURL}}" class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <span>ðŸ‡§ðŸ‡·</span>
                            <span>PortuguÃªs</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="md:hidden flex items-center">
                {{/* --- Mobile Language Toggle --- */}}
                <div class="flex items-center space-x-1 mr-2">
                    <a href="/set-lang?lang=en&redirect={{.Page.RequestURL}}" 
                       class="text-xs p-1 rounded-md {{if eq .Page.Lang "en"}}bg-blue-100{{else}}text-gray-500{{end}}">
                       ðŸ‡ºðŸ‡¸
                    </a>
                    <a href="/set-lang?lang=pt&redirect={{.Page.RequestURL}}" 
                       class="text-xs p-1 rounded-md {{if eq .Page.Lang "pt"}}bg-blue-100{{else}}text-gray-500{{end}}">
                       ðŸ‡§ðŸ‡·
                    </a>
                </div>

                <button id="mobile-menu-button" class="p-2 rounded-md text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500" aria-label="Main menu" aria-expanded="false">
                    <span class="sr-only">Open main menu</span>
                    <svg id="open-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    <svg id="close-icon" class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden border-t border-gray-200">
        
        {{/* --- MODIFIED: Replaced search link with a form --- */}}
        <form action="/search" method="GET" class="p-2 border-b border-gray-100">
            <div class="relative">
                <input type="text" name="q" placeholder="{{.Page.T.nav_search_placeholder}}" value="{{if eq .Data.PageTitle "Global Search"}}{{.Data.SearchQuery}}{{end}}" class="block w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 pl-3 pr-8 py-1.5">
                <button type="submit" class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600" title="{{.Page.T.search}}">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
            </div>
        </form>
        
        <a href="/" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Summary"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_summary}}</a>
        <a href="/full-list" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Full List"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_full_list}}</a>
        <a href="/activity" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Activity"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_activity}}</a>
        <a href="/discord" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Discord"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_discord}}</a>
        <a href="/chat" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Chat"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_chat}}</a>
        
        {{/* --- Mobile Statistics Dropdown --- */}}
        <details class="group" {{if $isStatsPage}}open{{end}}>
            <summary class="py-2 px-4 text-sm list-none flex justify-between cursor-pointer {{if $isStatsPage}}text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">
                <span>{{.Page.T.nav_statistics}}</span>
                 <svg class="w-4 h-4 transition-transform duration-200 group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="pl-4">
                <a href="/stats/drops" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Drop Stats"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_drop_stats}}</a>
                <a href="/players" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Player Count"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_player_count}}</a>
            </div>
        </details>
        
        <details class="group" {{if $isRankingPage}}open{{end}}>
            <summary class="py-2 px-4 text-sm list-none flex justify-between cursor-pointer {{if $isRankingPage}}text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">
                <span>{{.Page.T.nav_rankings}}</span>
                 <svg class="w-4 h-4 transition-transform duration-200 group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </summary>
            <div class="pl-4">
                <a href="/characters" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Characters"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_characters}}</a>
                <a href="/guilds" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "Guilds"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_guilds}}</a>
                <a href="/mvp-kills" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "MVP Kills"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_mvp_kills}}</a>
                <a href="/woe" class="block py-2 px-4 text-sm {{if eq .Data.PageTitle "WoE Rankings"}}bg-blue-50 text-blue-600 font-semibold{{else}}text-gray-600 hover:bg-gray-50{{end}}">{{.Page.T.nav_woe_rankings}}</a>
            </div>
        </details>
    </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Navigation Menu Logic ---
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const openIcon = document.getElementById('open-icon');
    const closeIcon = document.getElementById('close-icon');

    if (mobileMenuButton && mobileMenu && openIcon && closeIcon) {
        mobileMenuButton.addEventListener('click', function() {
            // Toggle menu visibility
            mobileMenu.classList.toggle('hidden');
            
            // Toggle icon visibility
            openIcon.classList.toggle('block');
            openIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('block');
            closeIcon.classList.toggle('hidden');
        });
    }

    // Function to set up a dropdown menu
    function setupDropdown(buttonId, contentId) {
        const button = document.getElementById(buttonId);
        const content = document.getElementById(contentId);
        if (!button || !content) return;

        button.addEventListener('click', (event) => {
            event.stopPropagation();
            // Close all other dropdowns first
            document.querySelectorAll('.dropdown-content').forEach(el => {
                if (el.id !== contentId) el.classList.add('hidden');
            });
            // Toggle the clicked dropdown
            content.classList.toggle('hidden');
        });
    }

    // --- MODIFIED: Initialize all dropdowns ---
    setupDropdown('ranking-dropdown-button', 'ranking-dropdown-content');
    setupDropdown('lang-dropdown-button', 'lang-dropdown-content');
    setupDropdown('stats-dropdown-button', 'stats-dropdown-content');

    // Global click listener to close dropdowns when clicking anywhere else
    window.addEventListener('click', () => {
        document.querySelectorAll('.dropdown-content').forEach(el => {
            el.classList.add('hidden');
        });
    });
});
</script>
